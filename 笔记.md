mybatis源码笔记：
 mybatis要运行，大致分为了三步：
  1.获取数据源
  2.获取待执行的sql
  3.执行
   
  String resource = "mybatis-config.xml";
  InputStream inputStream = Resources.getResourceAsStream(resource);
  SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);
  SqlSession sqlSession = sqlSessionFactory.openSession();
  OperChannel operChannel = sqlSession.selectOne("com.springsource.study.mybatis.OperChannelMapper.selectAll",1);
  
  
  <configuration>
      <environments default="development">
          <environment id="development">
              <transactionManager type="JDBC"></transactionManager>
              <dataSource type="POOLED">
                  <property name="driver" value="com.mysql.jdbc.Driver"/>
                  <property name="url" value="jdbc:mysql://localhost:3306/znyd"/>
                  <property name="username" value="root"/>
                  <property name="password" value="root"/>
              </dataSource>
          </environment>
      </environments>
  
      <mappers>
          <mapper resource="mybatis/operchannel.xml"></mapper>
      </mappers>
  </configuration>
  
  首先要知道一点：configuration对应着configuration类
  environment节点对应着environment对象 DataSource是包装在environment中
  
  源码从sqlSessionFactoryBuilder()的build方法开始看起
   1.首先获取到mybatis配置文件中的configuration节点
     parseConfiguration(parser.evalNode("/configuration"));
     
   2.解析配置文件中的environment节点，获取到事务管理器，然后获取到DataSource的type类型
    根据type获取到一个DataSourceFactory(这里是调用的Resources.classForName(string),其实底层就是调用了Class.forName),从DataSourcefactory中get到一个DataSource
    并将DataSource封装在environment对象中
   3.获取到数据源之后，解析mapper.xml文件，根据配置文件中的配置来解析
     mybatis解析mapper文件有四种方法：分别是package > resource > url > mapperClass
     解析到mapper.xml配置文件之后，会获取到当前的namespace,并循环遍历所有的select update insert delete
     将每个sql语句包装成mappedStatement对象,并将该对象存放到了mappedStatements这个map中，map的key是namespace+id(id指的是select标签的id)
     
     在将mappedStatement放到map中之后，会将当前namespace作为key，new MapperProxyFactory<>(type)作为value存到一个map中knownMappers(在通过getMapper这种方式执行SQL的时候会用到)
     
     至此：可以理解为已经获取到了要执行的SQL;要执行的SQL保存在mappedStatement对象中的SqlSource对象中
     
   4.执行查询语句
     首先根据select语句中的第一个入参从mappedStatements这个map中获取到mappedStatement对象
     如果是采用的sqlSession.getMapper方法，那这时候会先从 knownMappers 中，根据入参的类型(mapperInterface.class)，获取到mapperProxyFactory，然后通过jdk动态代理，创建接口对应的代理对象，然后调用目标方法
     调用目标方法的时候，会调用mapperProxy.invoke方法，在这个方法里面，调用对应的selectOne或者selectList
     在执行查询的时候，会先创建cachekey,然后从db中查询数据，查询的时候用的是prepareStatement.execute方法
     关于一级缓存这里，后面在详细学习
    
    
    
  selectOne 也是调用的selectList,在selectList返回数据之后，如果长度为1，就取list.get(0),否则的话，就报错 